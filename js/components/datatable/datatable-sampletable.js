$(document).ready(function(){renderBillingHistory()});var $sampleTable=$("#sample-table"),_billingHistoryUrl="../../../data/tabledata.json",_billingDataLength="",_searchString="",_searchActivity="",_filterLength=0,uniqueType=[],uniqueActivity=[],docFilterArr=[],payFilterArr=[];function renderBillingHistory(){$.ajax({url:_billingHistoryUrl,success:function(e){_billingDataLength=e.billingPayment.length}}),$sampleTable.DataTable({dom:"Bfrtip",destroy:!0,responsive:!0,ajax:{url:_billingHistoryUrl,dataSrc:"billingPayment"},language:{loadingRecords:"Please wait - loading...",zeroRecords:"No records available",info:" _START_ - _END_ of _TOTAL_ transactions",infoEmpty:"No records available",infoFiltered:" ( filtered from _MAX_ entries )"},order:[[0,"desc"]],aoColumnDefs:[{bSortable:!1,aTargets:[4]}],columns:[{data:"ConvertedActivityDate",sType:"date"},{data:"DocumentType",render:function(e,t,a,i){switch(e.toLowerCase()){case"deferral":return'<i class="activity-icon fa fa-clock-o"></i>'+e;case"budgetbill":return'<i class="activity-icon fa fa-money"></i>'+e;case"payment":return'<i class="activity-icon fa fa-check"></i>'+e;case"bill due":return'<i class="activity-icon fa fa-dollar"></i>'+e;case"payment arrangement enrollment":return'<i class="activity-icon fa fa-handshake-o"></i>'+e;default:return""}}},{data:"Amount",render:function(e,t,a,i){if(0<=e)return"$"+a.Amount.toLocaleString();var l=a.Amount.toLocaleString();return l=l.replace("-","-$")}},{data:"Channel",render:function(e,t,a,i){return"Autopay"===e?'<a href="#" class="tooltip-wrap">'+e+'<i  rel="tooltip" title="This account is enrolled in autopay."  class="fa fa-info-circle"></i></a>':e}},{data:"BillPdfUrl",render:function(e,t,a,i){return'<a target="_blank" href='+a.BillPdfUrl+'>Bill PDf<i class="fa fa-file-pdf-o"></i></a> <a target="_blank" href='+a.InsertUrl+'>Insert<i class="fa fa-external-link"></i></a>'}}],initComplete:function(e,t){0<$(".custom-filter").length&&$(".custom-filter").remove(),configFilter(this,[0,1,2,3]),this.api().columns(1).every(function(){$("div[data-activity-filter] select").remove();var e=$('<select class="form-control"><option value="">Select One..</option></select>').insertAfter($("div[data-activity-filter] .filter-header")),t=$(this.header()).text().replace(/\s+/g,"_");this.data().unique().sort().each(function(e,t){if(""!==e&&null!==e){var a=e.toLowerCase();uniqueActivity.push(a),uniqueActivity=$.unique(uniqueActivity)}});for(var a=0;a<uniqueActivity.length;a++)e.append('<option value="'+uniqueActivity[a]+'" id="'+t+"_"+a+'">'+uniqueActivity[a]+"</option>");uniqueActivity=[]}),this.api().columns(3).every(function(){var e=$(this.header()).text().replace(/\s+/g,"_");$("div[data-payment-filter] .checkbox").remove(),this.data().unique().sort().each(function(e,t){if(""!==e&&null!==e){var a=e.toLowerCase();uniqueType.push(a),uniqueType=$.unique(uniqueType)}});for(var t=0;t<uniqueType.length;t++)$("div[data-payment-filter] .filter-header").after('<div class="checkbox"><label for="'+e+"_"+t+'"><input type="checkbox" value="'+uniqueType[t]+'" id="'+e+"_"+t+'" />'+uniqueType[t]+"</label></div>");uniqueType=[]})},buttons:[{extend:"csv",className:"d-none",filename:"pse billing and payment history",exportOptions:{columns:[0,1,2,3]}}],drawCallback:function(){$("#billing-load-more").toggle(this.api().page.hasMore())}})}function amountValidate(e){if(46!=e.which&&45!=e.which&&46!=e.which&&!(48<=e.which&&e.which<=57))return!1}function billingFilterResult(e){var t,a=[],i=[],l=[];if(t=$(e.target.attributes)[1].name,$sampleTable.DataTable().rows({search:"applied"}).data().each(function(e,t){a.push(e)}),"data-update-amount"===t||"data-update-activity"===t||"data-update-activitydate"===t||"data-clear-filter"===t){$("div[data-payment-filter] .checkbox").remove();for(var n=0;n<a.length;n++)""!==a[n].Channel&&null!==a[n].Channel&&i.push(a[n].Channel.toLowerCase());for(var r=0;r<i.length;r++)-1==l.indexOf(i[r])&&l.push(i[r]);for(var o=0;o<l.length;o++)$("div[data-payment-filter] .filter-header").after('<div class="checkbox"><label for="Channel_'+o+'"><input type="checkbox" value="'+l[o]+'" id="Channel_'+o+'" />'+l[o]+"</label></div>");for(var c=_searchString.split("|"),s=0;s<c.length;s++)$("div[data-payment-filter]").find('input[type=checkbox][value="'+c[s]+'"]').prop("checked",!0);i=[],l=[]}if("data-update-amount"===t||"data-update-payment"===t||"data-update-activitydate"===t||"data-clear-filter"===t){$("div[data-activity-filter] select").remove();for(var d=$('<select class="form-control"><option value="">Select One..</option></select>').insertAfter($("div[data-activity-filter] .filter-header")),u=0;u<a.length;u++)""!==a[u].DocumentType&&null!==a[u].DocumentType&&i.push(a[u].DocumentType.toLowerCase());for(var p=0;p<i.length;p++)-1==l.indexOf(i[p])&&l.push(i[p]);for(var f=0;f<l.length;f++)d.append('<option value="'+l[f]+'" id="DocumentType_'+f+'">'+l[f]+"</option>");$("div[data-activity-filter] select").val(_searchActivity),i=[],l=[]}}$("#billing-export-csv").on("click",function(){$sampleTable.parent("div").find(".buttons-csv").click()}),$("#billing-load-more").on("click",function(){$sampleTable.DataTable().page.loadMore()}),$("[data-update-activity]").on("click",function(e){e.preventDefault(),_searchActivity="",_searchActivity=$(this).parents("div[data-activity-filter]").find("select").val(),$sampleTable.DataTable().column(1).search(_searchActivity,!0,!1).draw(),$(this).parents("div[data-customfilter-dropdown]").addClass("d-none"),billingFilterResult(e)}),$("[data-update-payment]").on("click",function(e){e.preventDefault();var a=0;_searchString="",$(this).parents("div[data-payment-filter]").find("input:checkbox").each(function(e,t){t.checked&&(_searchString+=0==a?t.value:"|"+t.value,a++)}),$sampleTable.DataTable().column(3).search(_searchString,!0,!1).draw(),$(this).parents("div[data-customfilter-dropdown]").addClass("d-none"),billingFilterResult(e)}),$("[data-update-amount]").on("click",function(e){var t,a;t=$("#minAmount").val(),a=$("#maxAmount").val(),t&&a&&(amountrangefilter(t,a),$sampleTable.dataTable().fnDraw()),$(this).parents("div[data-customfilter-dropdown]").addClass("d-none"),billingFilterResult(e)}),$("[data-update-activitydate]").on("click",function(e){var t=$("#billingFromDate input[type=text]").val(),a=$("#billingToDate input[type=text]").val();filterByDate(0,t,a),$(this).parents("div[data-customfilter-dropdown]").addClass("d-none"),$sampleTable.dataTable().fnDraw(),billingFilterResult(e)}),$(".clear-billing-date").on("click",function(e){e.preventDefault(),$(this).parents("div[data-customfilter-dropdown]").addClass("d-none"),$(this).parents("div[data-customfilter-dropdown]").find("input[type=text]").val(""),$.fn.dataTableExt.afnFiltering.length=0,$sampleTable.dataTable().fnDraw(),_filterLength=$sampleTable.DataTable().rows({filter:"applied"}).nodes().length,_billingDataLength==_filterLength&&(_searchString=_searchActivity="",billingFilterResult(e))}),$(".clear-activity").on("click",function(e){e.preventDefault(),$(this).parents("div[data-customfilter-dropdown]").addClass("d-none"),$(this).parents("div[data-customfilter-dropdown]").find("select").val(""),$sampleTable.DataTable().column(1).search("",!0,!1).draw(),$sampleTable.dataTable().fnDraw(),_filterLength=$sampleTable.DataTable().rows({filter:"applied"}).nodes().length,_billingDataLength==_filterLength&&(_searchString=_searchActivity="",billingFilterResult(e))}),$(".clear-amount").on("click",function(e){e.preventDefault(),$(this).parents("div[data-customfilter-dropdown]").addClass("d-none"),$(this).parents("div[data-customfilter-dropdown]").find("input[type=text]").val(""),amountrangefilter($("#minAmount").val(),$("#maxAmount").val()),$sampleTable.dataTable().fnDraw(),_filterLength=$sampleTable.DataTable().rows({filter:"applied"}).nodes().length,_billingDataLength==_filterLength&&(_searchString=_searchActivity="",billingFilterResult(e))}),$(".clear-payment").on("click",function(e){e.preventDefault(),$(this).parents("div[data-customfilter-dropdown]").addClass("d-none"),$(this).parents("div[data-customfilter-dropdown]").find("input:checkbox").each(function(e,t){t.checked&&(t.checked=!1)}),$sampleTable.DataTable().column(3).search("",!0,!1).draw(),$sampleTable.dataTable().fnDraw(),_filterLength=$sampleTable.DataTable().rows({filter:"applied"}).nodes().length,_billingDataLength==_filterLength&&(_searchString=_searchActivity="",billingFilterResult(e))}),$("[data-customfilter-dropdown] .close-menu").on("click",function(e){e.stopPropagation(),$(this).parents("div[data-customfilter-dropdown]").addClass("d-none")}),$("#billingFromDate,#billingToDate").datepicker({autoclose:!0});